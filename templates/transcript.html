{% extends "base.html" %}

{% block title %}Transcript - {{ video_id }} - YouTube Transcript Viewer{% endblock %}

{% block content %}
    <div class="video-info">
        <h2>📺 Video ID: {{ video_id }}</h2>
        <p><strong>YouTube URL:</strong> <a href="https://www.youtube.com/watch?v={{ video_id }}" target="_blank">https://www.youtube.com/watch?v={{ video_id }}</a></p>
    </div>
    
    <div class="proxy-info">
        <strong>🌐 Proxy used:</strong> {{ proxy_used }}
    </div>
    
    <div class="search-form">
        <form action="/watch" method="get">
            <input type="text" name="v" placeholder="Enter another video ID or URL" value="">
            <button type="submit">Get Transcript</button>
            {% if summarize_enabled %}
                <label style="margin-left: 10px;">
                    <input type="checkbox" name="summarize" value="true" {% if summary or summary_error %}checked{% endif %}>
                    Generate AI Summary
                </label>
            {% endif %}
        </form>
    </div>
    
    {% if summarize_enabled %}
        <div class="summary-actions" style="margin: 10px 0;">
            {% if not summary and not summary_error %}
                <a href="/watch?v={{ video_id }}&summarize=true" class="summary-button">🤖 Generate AI Summary</a>
            {% endif %}
        </div>
    {% endif %}
    
    {% if summary %}
        <div class="summary-section">
            <h3>🤖 AI-Generated Summary:</h3>
            <div class="summary-content">
                <pre>{{ summary }}</pre>
            </div>
        </div>
        <hr style="margin: 30px 0; border: 1px solid #ddd;">
    {% endif %}
    
    {% if summary_error %}
        <div class="summary-error">
            <h3>❌ Summary Error:</h3>
            <p style="color: #d32f2f;">{{ summary_error }}</p>
        </div>
        <hr style="margin: 30px 0; border: 1px solid #ddd;">
    {% endif %}
    
    {% if chapters %}
        <div class="chapters-info">
            <h3>📚 Video Chapters ({{ chapters|length }} chapters):</h3>
            <ul style="background: #f5f5f5; padding: 15px; border-radius: 5px; margin: 10px 0;">
                {% for chapter in chapters %}
                    <li><strong>{{ chapter.title }}</strong> - {{ "%.0f"|format(chapter.time // 60) }}:{{ "%02.0f"|format(chapter.time % 60) }}</li>
                {% endfor %}
            </ul>
        </div>
    {% endif %}
    
    <div class="transcript-options" style="margin: 20px 0;">
        <button onclick="toggleTranscriptView()" id="toggleBtn" style="background: #007bff; color: white; border: none; padding: 8px 16px; border-radius: 4px; cursor: pointer;">
            📖 Switch to Detailed View
        </button>
    </div>
    
    <h3>📝 Transcript ({{ transcript|length }} entries):</h3>
    
    <!-- Formatted readable transcript (default view) -->
    <div id="formatted-transcript" class="transcript-container" style="display: block;">
        <div class="formatted-text" style="background: #f9f9f9; padding: 20px; border-radius: 5px; line-height: 1.6; font-family: Georgia, serif;">
            <pre style="white-space: pre-wrap; font-family: Georgia, serif; margin: 0;">{{ formatted_transcript }}</pre>
        </div>
    </div>
    
    <!-- Detailed timestamp transcript (hidden by default) -->
    <div id="detailed-transcript" class="transcript-container" style="display: none;">
        {% for entry in transcript %}
            <div class="transcript-entry">
                <div class="timestamp">[{{ entry.formatted_time }}] ({{ "%.2f"|format(entry.time) }}s)</div>
                <div class="text">{{ entry.text }}</div>
            </div>
        {% endfor %}
    </div>
    
    <script>
        function toggleTranscriptView() {
            const formattedDiv = document.getElementById('formatted-transcript');
            const detailedDiv = document.getElementById('detailed-transcript');
            const toggleBtn = document.getElementById('toggleBtn');
            
            if (formattedDiv.style.display === 'none') {
                // Show formatted, hide detailed
                formattedDiv.style.display = 'block';
                detailedDiv.style.display = 'none';
                toggleBtn.textContent = '📖 Switch to Detailed View';
            } else {
                // Show detailed, hide formatted
                formattedDiv.style.display = 'none';
                detailedDiv.style.display = 'block';
                toggleBtn.textContent = '📄 Switch to Readable View';
            }
        }
    </script>
    
    <div style="text-align: center; margin-top: 20px;">
        <a href="/" style="color: #ff0000; text-decoration: none; font-weight: bold;">← Back to Home</a>
    </div>
{% endblock %}